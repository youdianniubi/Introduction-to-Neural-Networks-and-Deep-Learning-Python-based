# 动态行为交互模型 (这里属于设计范畴)

行为模型视图：这种视图表示了系统动态和行为。它还描述了在用户模型视图和结构模型视图中所描述的各种结构元素之间的交互和协作。





动态模型表示瞬时的、行为化的系统的“控制”性质，规定了对象模型中对象的合法变化序列。即对象的动态行为。
用状态图来描绘对象的状态、触发状态转换的事件、以及对象的行为（对事件的响应）。
每个类的动态行为用一张状态图来描绘，各个类的状态图通过共享事件合并起来，从而构成系统的动态模型






## 状态转换图（State Machine）

状态转换（迁移）图是描述对象的状态在响应外部的信号后进行转换的一种图形表示。

### 对现实世界对象的状态转换分析

我们以作业对象为例，绘制出状态转换图，如图6.7.1。

<div align="center">
<image src="Images/6-StateMachine1.jpg"/>

图6.7.1 - 需求分析阶段的作业对象状态转换图
</div>

在图6.7.1中，我们可以看到四种图例：

1. 起始和终止状态，圆形；
2. 状态，被观察到的对象行为模式，用圆角矩形表示；
3. 事件或行为，引起状态转换的外界事件，用有方向的连接线表示；
4. 菱形，判断条件。


也可以用表格来表示这种转换关系，但是不如状态转换图方便理解，如表6.7.1。

表6.7.1 - 状态转换表

|源状态\目标状态|到起始|到已接收|到已提交到|到已批改|到终止|
|--|--|--|--|--|--|
|从起始||学生收到作业||||
|从已接收|||学生完成作业|||
|从已提交||||老师批改作业||
|从已批改|||不合格，学生修改作业||作业合格|
|从终止||||||

### 区分需求分析和系统设计的边界

在需求分析阶段，很容易犯的错误是绘制如图6.7.2所示的状态转换图：

<div align="center">
<image src="Images/6-StateMachine2.jpg"/>

图6.7.2 - 系统设计阶段的作业对象状态转换图
</div>

比较图6.7.1和图6.7.2，我们可以看到后者多出来几个状态：

- 未完成
- 已完成
- 批改中

这是为什么呢？

因为前者是现实世界中的状态转换图，是一种（客观）需求分析的结果；而后者是软件世界的状态转换图，是（主观）系统设计的结果。

我们用“未完成”状态为例说明：

- 在现实世界中，未完成的状态确实存在，但是它对环境来说毫无意义，老师最后只看你是不是及时完成了作业，而家长会一直督促你，直到你完成作业，所以，“未完成”状态在现实世界中是一个不可接受的状态；

- 在软件世界中，如果处于“未完成”状态，学生是可以临时保存作业，留着以后再完成的，所以“未完成”状态对于软件系统（环境）来说，是有意义的：可以保存入磁盘，可以再次从磁盘加载到内存。

而“已完成”状态的意义是：到达这个状态后，软件系统才会允许提交作业进入下一个状态，相当于软件代替了老师和家长的监督作用：学生没有完成作业就必须完成，不能提交。

“批改中”的作用和“未完成”类似，也是可以保存入磁盘，以后再次加载的。

依赖于软件系统的支持，学生还可以决定：

- 是否在完成作业后，在回过头来修改；
- 是否在提交作业后，在老师还没有批改的前提下，收回作业，做进一步的修改。

### 系统的状态转换

前面我们介绍的是某个对象（类）的微观状态转换，对于一个大系统来说，也是有状态转换的，比如AI教育系统中的训练子系统，如图6.7.3所示：

<div align="center">
<image src="Images/6-StateMachine3.jpg"/>

图6.7.3 - 训练子系统状态转换图
</div>

1. 平时，训练子系统处于关闭状态，因为计划租用 Azure GPU 硬件，所以关闭时并不付费；
2. 管理员可以开启系统，达到空闲状态；也可以关闭系统，从空闲状态返回关闭状态；
3. 有新的任务进入队列后，系统进入繁忙状态；所有任务处理完毕后，系统从繁忙状态返回空闲状态；
4. 如果队列超长，系统会报警而进入“过热”状态，其实并非硬件温度过热，而是指系统的使用程度“过热”。这种报警的目的是让系统管理员知道情况，便于后期调整资源安排，比如忙时多加几台机器。当队列缩短后，系统返回“繁忙”状态。
5. 如果有硬件损坏或者掉电等情况，或者是管理员强制关闭系统，会返回到“关闭”状态，但是此事件极少发生。

这种系统级别的状态转换，是属于需求分析阶段还是属于系统设计阶段呢？有两种看法：

- 可以算作需求的一部分：需求方根据以往的经验，或者借鉴它人的经验，提出这个需求。当然，用户的需求可能是很简单的一句话：“当系统太忙的时候，我们需要得到通知。”
- 也可以算作设计的一部分：需求方没有想到这一点，而是需求分析人员或者系统设计人员从技术角度给与的建议，需要征求用户的同意后，成为技术需求的一部分。

笔者倾向于后一种看法，即它是系统设计的一部分，所以在需求分析阶段，可以不绘制这张图，而是留在系统设计阶段再拿出来。
